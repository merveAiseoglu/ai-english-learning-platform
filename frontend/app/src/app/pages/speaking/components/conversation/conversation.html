<!-- Conversation Container -->
<div class="conversation-container">
  <!-- Header Section -->
  <div class="conversation-header">
    <div class="header-left">
      <h2>ğŸ¤– AI KonuÅŸma PratiÄŸi</h2>
      <div class="connection-status" [ngClass]="connectionStatus">
        <span class="status-indicator"></span>
        <span class="status-text">
          {{
            connectionStatus === "connected"
              ? "BaÄŸlÄ±"
              : connectionStatus === "disconnected"
              ? "BaÄŸlantÄ± Yok"
              : "BaÄŸlanÄ±yor..."
          }}
        </span>
        <button
          *ngIf="connectionStatus === 'disconnected'"
          class="retry-btn"
          (click)="retryConnection()"
        >
          ğŸ”„ Yeniden Dene
        </button>
      </div>
    </div>

    <div class="header-controls">
      <!-- Language Selection -->
      <div class="control-group">
        <label>Dil:</label>
        <select
          [(ngModel)]="selectedLanguage"
          (change)="onLanguageChange()"
          [disabled]="isLoading"
        >
          <option *ngFor="let lang of languageOptions" [value]="lang.value">
            {{ lang.label }}
          </option>
        </select>
      </div>

      <!-- Difficulty Selection -->
      <div class="control-group">
        <label>Seviye:</label>
        <select
          [(ngModel)]="selectedDifficulty"
          (change)="onDifficultyChange()"
          [disabled]="isLoading"
        >
          <option *ngFor="let diff of difficultyOptions" [value]="diff.value">
            {{ diff.label }}
          </option>
        </select>
      </div>

      <!-- Action Buttons -->
      <button
        class="header-btn new-conversation"
        (click)="startNewConversation()"
        [disabled]="isLoading"
      >
        âœ¨ Yeni KonuÅŸma
      </button>

      <button
        class="header-btn clear-chat"
        (click)="clearChat()"
        [disabled]="isLoading"
      >
        ğŸ—‘ï¸ Temizle
      </button>
    </div>
  </div>

  <!-- Messages Container -->
  <div class="messages-container" #messagesContainer>
    <div
      *ngFor="let message of messages; trackBy: trackByMessageId"
      class="message-wrapper"
      [ngClass]="{
        'user-message': message.role === 'user',
        'ai-message': message.role === 'assistant'
      }"
    >
      <div class="message-bubble">
        <div class="message-avatar">
          <span *ngIf="message.role === 'user'">ğŸ‘¤</span>
          <span *ngIf="message.role === 'assistant'">ğŸ¤–</span>
        </div>

        <div class="message-content">
          <div
            class="message-text"
            [innerHTML]="formatMessageText(message?.content || '')"
          ></div>
          <div class="message-time">{{ formatTime(message.timestamp) }}</div>
        </div>
      </div>
    </div>

    <!-- Loading Indicator -->
    <div *ngIf="isLoading" class="message-wrapper ai-message">
      <div class="message-bubble loading">
        <div class="message-avatar">
          <span>ğŸ¤–</span>
        </div>
        <div class="message-content">
          <div class="typing-indicator">
            <span></span>
            <span></span>
            <span></span>
          </div>
          <div class="message-text loading-text">AI dÃ¼ÅŸÃ¼nÃ¼yor...</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Input Section -->
  <div class="input-section">
    <div class="input-container">
      <div class="input-wrapper">
        <textarea
          #messageInput
          [(ngModel)]="currentMessage"
          (keypress)="onKeyPress($event)"
          placeholder="MesajÄ±nÄ±zÄ± yazÄ±n... (Enter ile gÃ¶nderin, Shift+Enter ile yeni satÄ±r)"
          class="message-input"
          [disabled]="isLoading || connectionStatus === 'disconnected'"
          rows="1"
        ></textarea>

        <button
          class="send-button"
          (click)="sendMessage()"
          [disabled]="
            !currentMessage.trim() ||
            isLoading ||
            connectionStatus === 'disconnected'
          "
          [class.loading]="isLoading"
        >
          <span *ngIf="!isLoading">ğŸ“¤</span>
          <span *ngIf="isLoading" class="spinner">â³</span>
        </button>
      </div>

      <!-- Input Helper Text -->
      <div class="input-helper">
        <small *ngIf="connectionStatus === 'disconnected'" class="error-text">
          âŒ Sunucuya baÄŸlanÄ±lamÄ±yor. Backend Ã§alÄ±ÅŸtÄ±ÄŸÄ±ndan emin olun.
        </small>
        <small *ngIf="connectionStatus === 'connected'" class="helper-text">
          ğŸ’¡ Enter ile mesaj gÃ¶nderin, Shift+Enter ile yeni satÄ±r ekleyin
        </small>
      </div>
    </div>
  </div>

  <!-- Stats Section -->
  <div class="stats-section" *ngIf="messages.length > 1">
    <div class="stats-item">
      <span class="stats-label">Toplam Mesaj:</span>
      <span class="stats-value">{{ messages.length }}</span>
    </div>
    <div class="stats-item">
      <span class="stats-label">KonuÅŸma ID:</span>
      <span class="stats-value">{{ getCurrentConversationId() }}</span>
    </div>
  </div>
</div>